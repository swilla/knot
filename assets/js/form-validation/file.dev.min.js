/**
 * jQuery Form Validator Module: File
 * ------------------------------------------
 * Created by Victor Jonsson <http://www.victorjonsson.se>
 *
 * The following validators will be added by this module:
 *  - mime type
 *  - file size
 *  - file extension
 *
 * @website http://formvalidator.net/
 * @license Dual licensed under the MIT or GPL Version 2 licenses
 * @version 2.2.beta.57
 */
!function(e,r){"use strict";var t="undefined"!=typeof r.FileReader,n=function(r){var t=e.split((r.valAttr("allowing")||"").toLowerCase());return e.inArray("jpg",t)>-1&&-1==e.inArray("jpeg",t)?t.push("jpeg"):e.inArray("jpeg",t)>-1&&-1==e.inArray("jpg",t)&&t.push("jpg"),t},i=function(e,r,t,n){var i=n[r];e.errorMessageKey="",e.errorMessage=i.replace("%s",t)},a=function(e){r.console&&r.console.log&&r.console.log(e)};e.formUtils.addValidator({name:"mime",validatorFunction:function(r,o,s,l){if(t){var u=!0,f=o.get(0).files||[],g="",d=n(o);return f.length&&(e.each(f,function(r,t){return u=!1,g=t.type||"",e.each(d,function(e,r){return u=g.indexOf(r)>-1,u?!1:void 0}),u}),u||(a("Trying to upload a file with mime type "+g+" which is not allowed"),i(this,"wrongFileType",d.join(", "),l))),u}return a("FileReader not supported by browser, will check file extension"),e.formUtils.validators.validate_extension.validatorFunction(r,o)},errorMessage:"",errorMessageKey:"wrongFileType"}),e.formUtils.addValidator({name:"extension",validatorFunction:function(r,t,a,o){var s=!0,l=this,u=n(t);return e.each(t.get(0).files||[r],function(r,t){var n="string"==typeof t?t:t.value||t.fileName||t.name,a=n.substr(n.lastIndexOf(".")+1);return-1==e.inArray(a.toLowerCase(),u)?(s=!1,i(l,"wrongFileType",u.join(", "),o),!1):void 0}),s},errorMessage:"",errorMessageKey:"wrongFileType"}),e.formUtils.addValidator({name:"size",validatorFunction:function(r,n,o,s){var l=n.valAttr("max-size");if(!l)return a('Input "'+n.attr("name")+'" is missing data-validation-max-size attribute'),!0;if(!t)return!0;var u=e.formUtils.convertSizeNameToBytes(l),f=!0;return e.each(n.get(0).files||[],function(e,r){return f=r.size<=u}),f||i(this,"wrongFileSize",l,s),f},errorMessage:"",errorMessageKey:"wrongFileSize"}),e.formUtils.convertSizeNameToBytes=function(e){return e=e.toUpperCase(),"M"==e.substr(e.length-1,1)?1024*parseInt(e.substr(0,e.length-1),10)*1024:"MB"==e.substr(e.length-2,2)?1024*parseInt(e.substr(0,e.length-2),10)*1024:"KB"==e.substr(e.length-2,2)?1024*parseInt(e.substr(0,e.length-2),10):"B"==e.substr(e.length-1,1)?parseInt(e.substr(0,e.length-1),10):parseInt(e,10)},e(r).one("validatorsLoaded formValidationSetup",function(r,t){var n;n=t?t.find('input[type="file"]'):e('input[type="file"]'),n.filter("*[data-validation]").bind("change",function(){e(this).removeClass("error").parent().find(".form-error").remove()})})}(jQuery,window);