!function(e,t){"use strict";e.formUtils.addValidator({name:"spamcheck",validatorFunction:function(e,t){var r=t.valAttr("captcha");return r===e},errorMessage:"",errorMessageKey:"badSecurityAnswer"}),e.formUtils.addValidator({name:"confirmation",validatorFunction:function(e,t,r,a,n){var i="",l=t.valAttr("confirm")||t.attr("name")+"_confirmation",o=n.find('input[name="'+l+'"]').eq(0);return o?i=o.val():console.warn('Could not find an input with name "'+l+'"'),e===i},errorMessage:"",errorMessageKey:"notConfirmed"});var r={amex:[15,15],diners_club:[14,14],cjb:[16,16],laser:[16,19],visa:[16,16],mastercard:[16,16],maestro:[12,19],discover:[16,16]},a=!1,n=!1;e.formUtils.addValidator({name:"creditcard",validatorFunction:function(t,i){var l=e.split(i.valAttr("allowing")||"");if(n=e.inArray("amex",l)>-1,a=n&&1==l.length,l.length>0){var o=!1;if(e.each(l,function(e,a){if(a in r){if(t.length>=r[a][0]&&t.length<=r[a][1])return o=!0,!1}else console.warn('Use of unknown credit card "'+a+'"')}),!o)return!1}if(""!==t.replace(new RegExp("[0-9]","g"),""))return!1;var s=0;return e.each(t.split("").reverse(),function(e,t){t=parseInt(t,10),e%2===0?s+=t:(t*=2,s+=10>t?t:t-9)}),s%10===0},errorMessage:"",errorMessageKey:"badCreditCard"}),e.formUtils.addValidator({name:"cvv",validatorFunction:function(e){return""===e.replace(/[0-9]/g,"")?(e+="",a?4==e.length:n?3==e.length||4==e.length:3==e.length):!1},errorMessage:"",errorMessageKey:"badCVV"}),e.formUtils.addValidator({name:"strength",validatorFunction:function(t,r){var a=r.valAttr("strength");return a&&a>3&&(a=3),e.formUtils.validators.validate_strength.calculatePasswordStrength(t)>=a},errorMessage:"",errorMessageKey:"badStrength",calculatePasswordStrength:function(e){if(e.length<4)return 0;var t=0,r=function(e,t){for(var r="",a=0;a<t.length;a++){for(var n=!0,i=0;e>i&&i+a+e<t.length;i++)n=n&&t.charAt(i+a)==t.charAt(i+a+e);e>i&&(n=!1),n?(a+=e-1,n=!1):r+=t.charAt(a)}return r};return t+=4*e.length,t+=1*(r(1,e).length-e.length),t+=1*(r(2,e).length-e.length),t+=1*(r(3,e).length-e.length),t+=1*(r(4,e).length-e.length),e.match(/(.*[0-9].*[0-9].*[0-9])/)&&(t+=5),e.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)&&(t+=5),e.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(t+=10),e.match(/([a-zA-Z])/)&&e.match(/([0-9])/)&&(t+=15),e.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&e.match(/([0-9])/)&&(t+=15),e.match(/([!,@,#,$,%,^,&,*,?,_,~])/)&&e.match(/([a-zA-Z])/)&&(t+=15),(e.match(/^\w+$/)||e.match(/^\d+$/))&&(t-=10),0>t&&(t=0),t>100&&(t=100),20>t?0:40>t?1:60>=t?2:3},strengthDisplay:function(t,r){var a={fontSize:"12pt",padding:"4px",bad:"Very bad",weak:"Weak",good:"Good",strong:"Strong"};r&&e.extend(a,r),t.bind("keyup",function(){var t=e(this).val(),r="undefined"==typeof a.parent?e(this).parent():e(a.parent),n=r.find(".strength-meter");0==n.length&&(n=e("<span></span>"),n.addClass("strength-meter").appendTo(r)),t?n.show():n.hide();var i=e.formUtils.validators.validate_strength.calculatePasswordStrength(t),l={background:"pink",color:"#FF0000",fontWeight:"bold",border:"red solid 1px",borderWidth:"0px 0px 4px",display:"inline-block",fontSize:a.fontSize,padding:a.padding},o=a.bad;1==i?o=a.weak:2==i?(l.background="lightyellow",l.borderColor="yellow",l.color="goldenrod",o=a.good):i>=3&&(l.background="lightgreen",l.borderColor="darkgreen",l.color="darkgreen",o=a.strong),n.css(l).text(o)})}});var i=function(r,a,n,i,l){var o=a.valAttr("req-params");o||(o={}),"string"==typeof o&&(o=e.parseJSON(o)),o[a.attr("name")]=n,e.ajax({url:r,type:"POST",cache:!1,data:o,dataType:"json",error:function(e){alert("Server validation failed due to: "+e.statusText),t.JSON&&t.JSON.stringify&&alert(t.JSON.stringify(e))},success:function(t){t.valid?a.valAttr("backend-valid","true"):(a.valAttr("backend-invalid","true"),t.message&&a.attr(i.validationErrorMsgAttribute,t.message)),a.valAttr("has-keyup-event")||a.valAttr("has-keyup-event","1").bind("keyup",function(t){9!=t.keyCode&&16!=t.keyCode&&e(this).valAttr("backend-valid",!1).valAttr("backend-invalid",!1)}),l()}})},l=function(){return!1};e.formUtils.addValidator({name:"server",validatorFunction:function(t,r,a,n,o){var s=r.valAttr("backend-valid"),d=r.valAttr("backend-invalid"),c=document.location.href;return r.valAttr("url")?c=r.valAttr("url"):"serverURL"in a&&(c=a.backendUrl),s?!0:d?!1:"keyup"==e.formUtils.eventType?null:e.formUtils.isValidatingEntireForm?(o.bind("submit",l).addClass("validating-server-side").addClass("on-blur"),r.addClass("validating-server-side"),e.formUtils.haltValidation=!0,i(c,r,t,a,function(){o.removeClass("validating-server-side").removeClass("on-blur").get(0).onsubmit=function(){},o.unbind("submit",l),r.removeClass("validating-server-side"),r.valAttr("value-length",t.length),e.formUtils.haltValidation=!1,o.trigger("submit")}),null):(o.addClass("validating-server-side"),r.addClass("validating-server-side"),i(c,r,t,a,function(){o.removeClass("validating-server-side"),r.removeClass("validating-server-side"),r.trigger("blur")}),null)},errorMessage:"",errorMessageKey:"badBackend",validateOnKeyUp:!1}),e.fn.displayPasswordStrength=function(t){return new e.formUtils.validators.validate_strength.strengthDisplay(this,t),this}}(jQuery,window);