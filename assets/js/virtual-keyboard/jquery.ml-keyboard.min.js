!function(t){function e(e){this.keyboard="[object Arguments]"==Object.prototype.toString.call(e)?e[0]:e,this.$key=t("<li/>"),this.current_value=null}function i(){e.call(this,arguments),this.id="mlkeyboard-backspace",this.default_value="delete"}function o(){e.call(this,arguments),this.id="mlkeyboard-tab",this.default_value="tab"}function u(){e.call(this,arguments),this.id="mlkeyboard-capslock",this.default_value="caps lock"}function d(){e.call(this,arguments),this.id="mlkeyboard-return",this.default_value="return"}function s(){e.call(this,arguments),this.id="mlkeyboard-"+arguments[1]+"-shift",this.default_value="shift"}function n(){e.call(this,arguments),this.id="mlkeyboard-space",this.default_value=" "}function r(e){this.defaults={layout:"en_us",active_shift:!0,active_caps:!1,is_hidden:!0,open_speed:300,close_speed:100,enabled:!0},this.global_options=t.extend({},this.defaults,e),this.options=t.extend({},{},this.global_options),this.keys=[],this.$keyboard=t("<div/>").attr("id","mlkeyboard"),this.$modifications_holder=t("<ul/>").addClass("mlkeyboard-modifications"),this.$current_input=t("input[type='text']").first()}e.prototype.render=function(){return this.id&&this.$key.attr("id",this.id),this.$key},e.prototype.setCurrentValue=function(){this.current_value=this.keyboard.upperRegister()?this.preferences.u?this.preferences.u:this.default_value:this.preferences.d?this.preferences.d:this.default_value,this.$key.text(this.current_value)},e.prototype.setCurrentAction=function(){var t=this;this.$key.unbind("click.mlkeyboard"),this.$key.bind("click.mlkeyboard",function(){t.keyboard.keep_focus=!0,"function"==typeof t.preferences.onClick?t.preferences.onClick(t):t.defaultClickAction()})},e.prototype.defaultClickAction=function(){this.keyboard.destroyModifications(),this.is_modificator?(this.keyboard.deleteChar(),this.keyboard.printChar(this.current_value)):this.keyboard.printChar(this.current_value),this.preferences.m&&"[object Array]"===Object.prototype.toString.call(this.preferences.m)&&this.showModifications(),this.keyboard.active_shift&&this.keyboard.toggleShift(!1)},e.prototype.showModifications=function(){var i=this;this.keyboard.modifications=[],t.each(this.preferences.m,function(t,o){var u=new e(i.keyboard);u.is_modificator=!0,u.preferences=o,i.keyboard.modifications.push(u)}),this.keyboard.showModifications(this)},e.prototype.toggleActiveState=function(){this.isActive()?this.$key.addClass("active"):this.$key.removeClass("active")},e.prototype.isActive=function(){return!1},i.prototype=new e,i.prototype.constructor=i,i.prototype.defaultClickAction=function(){this.keyboard.deleteChar()},o.prototype=new e,o.prototype.constructor=o,o.prototype.defaultClickAction=function(){this.keyboard.$current_input.next(":input").focus()},u.prototype=new e,u.prototype.constructor=u,u.prototype.isActive=function(){return this.keyboard.active_caps},u.prototype.defaultClickAction=function(){this.keyboard.toggleCaps()},d.prototype=new e,d.prototype.constructor=d,d.prototype.defaultClickAction=function(){var e=t.Event("keypress",{which:13,keyCode:13});this.keyboard.$current_input.trigger(e)},s.prototype=new e,s.prototype.constructor=s,s.prototype.isActive=function(){return this.keyboard.active_shift},s.prototype.defaultClickAction=function(){this.keyboard.toggleShift()},n.prototype=new e,n.prototype.constructor=n;var a=53;r.prototype.init=function(){this.$keyboard.append(this.renderKeys()),this.$keyboard.append(this.$modifications_holder),t("body").append(this.$keyboard),this.options.is_hidden&&this.$keyboard.hide(),this.setUpKeys()},r.prototype.setUpKeys=function(){var e=this;this.active_shift=this.options.active_shift,this.active_caps=this.options.active_caps,t.each(this.keys,function(t,i){i.preferences=mlKeyboard.layouts[e.options.layout][t],i.setCurrentValue(),i.setCurrentAction(),i.toggleActiveState()})},r.prototype.renderKeys=function(){for(var r=t("<ul/>"),c=0;a>=c;c++){var p;switch(c){case 13:p=new i(this);break;case 14:p=new o(this);break;case 28:p=new u(this);break;case 40:p=new d(this);break;case 41:p=new s(this,"left");break;case 52:p=new s(this,"right");break;case 53:p=new n(this);break;default:p=new e(this)}this.keys.push(p),r.append(p.render())}return r},r.prototype.setUpFor=function(e){var i=this;e.bind("focus",function(){var e=!i.$current_input||t(this)[0]!==i.$current_input[0];if(!i.keep_focus||e){if(e&&(i.keep_focus=!0),i.$current_input=t(this),i.options=t.extend({},i.global_options,i.inputLocalOptions()),!i.options.enabled)return i.keep_focus=!1,void 0;""!==i.$current_input.val()&&(i.options.active_shift=!1),i.setUpKeys(),i.options.is_hidden&&i.$keyboard.slideDown(i.options.openSpeed)}}),e.bind("blur",function(){var t=500;clearTimeout(i.blur_timeout),i.blur_timeout=setTimeout(function(){i.keep_focus?i.keep_focus=!1:i.options.is_hidden&&i.$keyboard.slideUp(i.options.closeSpeed)},t)})},r.prototype.inputLocalOptions=function(){var t={};for(var e in this.defaults){var i=this.$current_input.attr("data-mlkeyboard-"+e);"false"==i?i=!1:"true"==i&&(i=!0),"undefined"!=typeof i&&(t[e]=i)}return t},r.prototype.printChar=function(t){var e=this.$current_input.val();this.$current_input.val(e+t),this.$current_input.focus().trigger("input")},r.prototype.deleteChar=function(){var t=this.$current_input.val();this.$current_input.val(t.slice(0,-1)),this.$current_input.focus().trigger("input")},r.prototype.showModifications=function(e){var i,o,u,d=this,s=parseInt(d.$modifications_holder.css("padding"),10);t.each(this.modifications,function(t,e){d.$modifications_holder.append(e.render()),e.setCurrentValue(),e.setCurrentAction()}),u=e.$key.width()*d.modifications.length+6*d.modifications.length,i=e.$key.position().top-s,o=e.$key.position().left-d.modifications.length*e.$key.width()/2,this.$modifications_holder.one("mouseleave",function(){d.destroyModifications()}),this.$modifications_holder.css({width:u,top:i,left:o}).show()},r.prototype.destroyModifications=function(){this.$modifications_holder.empty().hide()},r.prototype.upperRegister=function(){return this.active_shift&&!this.active_caps||!this.active_shift&&this.active_caps},r.prototype.toggleShift=function(t){this.active_shift=t?t:!this.active_shift,this.changeKeysState()},r.prototype.toggleCaps=function(t){this.active_caps=t?t:!this.active_caps,this.changeKeysState()},r.prototype.changeKeysState=function(){t.each(this.keys,function(t,e){e.setCurrentValue(),e.toggleActiveState()})},t.fn.mlKeyboard=function(e){var i=new r(e);i.init(),this.each(function(){i.setUpFor(t(this))})}}(jQuery);var mlKeyboard=mlKeyboard||{layouts:{}};mlKeyboard.layouts.en_us=[{d:"`",u:"~"},{d:"1",u:"!"},{d:"2",u:"@"},{d:"3",u:"#"},{d:"4",u:"$"},{d:"5",u:"%"},{d:"6",u:"^"},{d:"7",u:"&"},{d:"8",u:"*"},{d:"9",u:"("},{d:"0",u:")"},{d:"-",u:"_"},{d:"=",u:"+"},{},{},{d:"q",u:"Q"},{d:"w",u:"W"},{d:"e",u:"E"},{d:"r",u:"R"},{d:"t",u:"T"},{d:"y",u:"Y"},{d:"u",u:"U"},{d:"i",u:"I"},{d:"o",u:"O"},{d:"p",u:"P"},{d:"]",u:"}"},{d:"[",u:"{"},{d:"\\",u:"|"},{},{d:"a",u:"A"},{d:"s",u:"S"},{d:"d",u:"D"},{d:"f",u:"F"},{d:"g",u:"G"},{d:"h",u:"H"},{d:"j",u:"J"},{d:"k",u:"K"},{d:"l",u:"L"},{d:";",u:":"},{d:"'",u:'"'},{},{},{d:"z",u:"Z"},{d:"x",u:"X"},{d:"c",u:"C"},{d:"v",u:"V"},{d:"b",u:"B"},{d:"n",u:"N"},{d:"m",u:"M"},{d:",",u:"<"},{d:".",u:">"},{d:"/",u:"?"},{},{}];var mlKeyboard=mlKeyboard||{layouts:{}};mlKeyboard.layouts.ru=[{d:"ё",u:"Ё"},{d:"1",u:"!"},{d:"2",u:"'"},{d:"3",u:"№"},{d:"4",u:"%"},{d:"5",u:":"},{d:"6",u:","},{d:"7",u:"."},{d:"8",u:";"},{d:"9",u:"("},{d:"0",u:")"},{d:"-",u:"_"},{d:"=",u:"+"},{},{},{d:"й",u:"Й"},{d:"ц",u:"Ц"},{d:"у",u:"У"},{d:"к",u:"К"},{d:"е",u:"Е"},{d:"н",u:"Н"},{d:"г",u:"Г"},{d:"ш",u:"Ш"},{d:"щ",u:"Щ"},{d:"з",u:"З"},{d:"х",u:"Х"},{d:"ъ",u:"Ъ"},{d:"|",u:"\\"},{},{d:"ф",u:"Ф"},{d:"ы",u:"Ы"},{d:"в",u:"В"},{d:"а",u:"А"},{d:"п",u:"П"},{d:"р",u:"Р"},{d:"о",u:"О"},{d:"л",u:"Л"},{d:"д",u:"Д"},{d:"ж",u:"Ж"},{d:"э",u:"Э"},{},{},{d:"я",u:"Я"},{d:"ч",u:"Ч"},{d:"с",u:"С"},{d:"м",u:"М"},{d:"и",u:"И"},{d:"т",u:"Т"},{d:"ь",u:"Ь"},{d:"б",u:"Б"},{d:"ю",u:"Ю"},{d:".",u:","},{},{}];var mlKeyboard=mlKeyboard||{layouts:{}};mlKeyboard.layouts.es=[{d:"<",u:">"},{d:"1",u:"¡"},{d:"2",u:"!"},{d:"3",u:"#"},{d:"4",u:"$"},{d:"5",u:"%"},{d:"6",u:"/"},{d:"7",u:"&"},{d:"8",u:"*"},{d:"9",u:"("},{d:"0",u:")"},{d:"-",u:"_"},{d:"=",u:"+"},{},{},{d:"q",u:"Q"},{d:"w",u:"W"},{d:"e",u:"E",m:[{d:"e",u:"E"},{d:"é",u:"É"}]},{d:"r",u:"R"},{d:"t",u:"T"},{d:"y",u:"Y"},{d:"u",u:"U",m:[{d:"u",u:"U"},{d:"ú",u:"Ú"},{d:"ü",u:"Ü"}]},{d:"i",u:"I",m:[{d:"i",u:"I"},{d:"í",u:"Í"}]},{d:"o",u:"O",m:[{d:"o",u:"O"},{d:"ó",u:"Ó"}]},{d:"p",u:"P"},{d:"´",u:"º"},{d:"`",u:"¨"},{d:"'",u:'"'},{},{d:"a",u:"A",m:[{d:"a",u:"A"},{d:"á",u:"Á"}]},{d:"s",u:"S"},{d:"d",u:"D"},{d:"f",u:"F"},{d:"g",u:"G"},{d:"h",u:"H"},{d:"j",u:"J"},{d:"k",u:"K"},{d:"l",u:"L"},{d:"ñ",u:"Ñ"},{d:";",u:":"},{},{},{d:"z",u:"Z"},{d:"x",u:"X"},{d:"c",u:"C"},{d:"v",u:"V"},{d:"b",u:"B"},{d:"n",u:"N"},{d:"m",u:"M"},{d:",",u:"¿"},{d:".",u:"?"},{d:"ç",u:"Ç"},{},{}];