!function(t){"function"==typeof define&&define.amd?define(["jquery","moment"],t):"object"==typeof exports?t(require("jquery"),require("moment")):t(jQuery,moment)}(function(t,n){function e(e,s){if(this.element=e,this.options=t.extend(!0,{},i,s),this.options.events.length&&(this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(this.options.events):this.addMomentObjectToEvents(this.options.events)),this.month=this.options.startWithMonth?n(this.options.startWithMonth).startOf("month"):n().startOf("month"),this.options.constraints){if(this.options.constraints.startDate){var a=n(this.options.constraints.startDate);this.month.isBefore(a,"month")&&(this.month.set("month",a.month()),this.month.set("year",a.year()))}if(this.options.constraints.endDate){var r=n(this.options.constraints.endDate);this.month.isAfter(r,"month")&&this.month.set("month",r.month()).set("year",r.year())}}this._defaults=i,this._name=o,this.init()}var s="<div class='clndr-controls'><div class='clndr-control-button'><span class='clndr-previous-button'>previous</span></div><div class='month'><%= month %> <%= year %></div><div class='clndr-control-button rightalign'><span class='clndr-next-button'>next</span></div></div><table class='clndr-table' border='0' cellspacing='0' cellpadding='0'><thead><tr class='header-days'><% for(var i = 0; i < daysOfTheWeek.length; i++) { %><td class='header-day'><%= daysOfTheWeek[i] %></td><% } %></tr></thead><tbody><% for(var i = 0; i < numberOfRows; i++){ %><tr><% for(var j = 0; j < 7; j++){ %><% var d = j + i * 7; %><td class='<%= days[d].classes %>'><div class='day-contents'><%= days[d].day %></div></td><% } %></tr><% } %></tbody></table>",o="clndr",i={template:s,weekOffset:0,startWithMonth:null,clickEvents:{click:null,nextMonth:null,previousMonth:null,nextYear:null,previousYear:null,today:null,onMonthChange:null,onYearChange:null},targets:{nextButton:"clndr-next-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button",todayButton:"clndr-today-button",day:"day",empty:"empty"},classes:{today:"today",event:"event",past:"past",lastMonth:"last-month",nextMonth:"next-month",adjacentMonth:"adjacent-month",inactive:"inactive"},events:[],extras:null,dateParameter:"date",multiDayEvents:null,doneRendering:null,render:null,daysOfTheWeek:null,showAdjacentMonths:!0,adjacentDaysChangeMonth:!1,ready:null,constraints:null,forceSixRows:null};e.prototype.init=function(){if(this.daysOfTheWeek=this.options.daysOfTheWeek||[],!this.options.daysOfTheWeek){this.daysOfTheWeek=[];for(var e=0;7>e;e++)this.daysOfTheWeek.push(n().weekday(e).format("dd").charAt(0))}if(this.options.weekOffset&&(this.daysOfTheWeek=this.shiftWeekdayLabels(this.options.weekOffset)),!t.isFunction(this.options.render)){if(this.options.render=null,"undefined"==typeof _)throw new Error("Underscore was not found. Please include underscore.js OR provide a custom render function.");this.compiledClndrTemplate=_.template(this.options.template)}t(this.element).html("<div class='clndr'></div>"),this.calendarContainer=t(".clndr",this.element),this.bindEvents(),this.render(),this.options.ready&&this.options.ready.apply(this,[])},e.prototype.shiftWeekdayLabels=function(t){for(var n=this.daysOfTheWeek,e=0;t>e;e++)n.push(n.shift());return n},e.prototype.createDaysObject=function(e){var s=[],o=e.startOf("month");if(this.eventsLastMonth=[],this.eventsThisMonth=[],this.eventsNextMonth=[],this.options.events.length)if(this.options.multiDayEvents){if(this.eventsThisMonth=t(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")===e.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")===e.format("YYYY-MM")?!0:this._clndrStartDateObject.format("YYYY-MM")<=e.format("YYYY-MM")&&this._clndrEndDateObject.format("YYYY-MM")>=e.format("YYYY-MM")?!0:!1}).toArray(),this.options.showAdjacentMonths){var i=e.clone().subtract(1,"months"),a=e.clone().add(1,"months");this.eventsLastMonth=t(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")===i.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")===i.format("YYYY-MM")?!0:this._clndrStartDateObject.format("YYYY-MM")<=i.format("YYYY-MM")&&this._clndrEndDateObject.format("YYYY-MM")>=i.format("YYYY-MM")?!0:!1}).toArray(),this.eventsNextMonth=t(this.options.events).filter(function(){return this._clndrStartDateObject.format("YYYY-MM")===a.format("YYYY-MM")||this._clndrEndDateObject.format("YYYY-MM")===a.format("YYYY-MM")?!0:this._clndrStartDateObject.format("YYYY-MM")<=a.format("YYYY-MM")&&this._clndrEndDateObject.format("YYYY-MM")>=a.format("YYYY-MM")?!0:!1}).toArray()}}else if(this.eventsThisMonth=t(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==e.format("YYYY-MM")}).toArray(),this.options.showAdjacentMonths){var i=e.clone().subtract(1,"months"),a=e.clone().add(1,"months");this.eventsLastMonth=t(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==i.format("YYYY-MM")}).toArray(),this.eventsNextMonth=t(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM")==a.format("YYYY-MM")}).toArray()}var r=o.weekday()-this.options.weekOffset;if(0>r&&(r+=7),this.options.showAdjacentMonths)for(var h=0;r>h;h++){var c=n([e.year(),e.month(),h-r+1]);s.push(this.createDayObject(c,this.eventsLastMonth))}else for(var h=0;r>h;h++)s.push(this.calendarDay({classes:this.options.targets.empty+" "+this.options.classes.lastMonth}));for(var l=o.daysInMonth(),h=1;l>=h;h++){var c=n([e.year(),e.month(),h]);s.push(this.createDayObject(c,this.eventsThisMonth))}for(var h=1;s.length%7!==0;){if(this.options.showAdjacentMonths){var c=n([e.year(),e.month(),l+h]);s.push(this.createDayObject(c,this.eventsNextMonth))}else s.push(this.calendarDay({classes:this.options.targets.empty+" "+this.options.classes.nextMonth}));h++}if(this.options.forceSixRows&&42!==s.length)for(var p=n(s[s.length-1].date).add(1,"days");s.length<42;)this.options.showAdjacentMonths?(s.push(this.createDayObject(n(p),this.eventsNextMonth)),p.add(1,"days")):s.push(this.calendarDay({classes:this.options.targets.empty+" "+this.options.classes.nextMonth}));return s},e.prototype.createDayObject=function(t,e){var s=[],o=n(),i=this,a=0,r=e.length;for(a;r>a;a++){var h,c,l=e[a];i.options.multiDayEvents?(h=l._clndrStartDateObject,c=l._clndrEndDateObject):h=l._clndrDateObject,i.options.multiDayEvents&&c.diff(h,!1)?(t.isSame(h,"day")||t.isAfter(h,"day"))&&(t.isSame(c,"day")||t.isBefore(c,"day"))&&s.push(l):t.isSame(h,"day")&&s.push(l)}var p="";return o.format("YYYY-MM-DD")==t.format("YYYY-MM-DD")&&(p+=" "+this.options.classes.today),t.isBefore(o,"day")&&(p+=" "+this.options.classes.past),s.length&&(p+=" "+this.options.classes.event),this.month.month()>t.month()?(p+=" "+this.options.classes.adjacentMonth,p+=this.month.year()===t.year()?" "+this.options.classes.lastMonth:" "+this.options.classes.nextMonth):this.month.month()<t.month()&&(p+=" "+this.options.classes.adjacentMonth,p+=this.month.year()===t.year()?" "+this.options.classes.nextMonth:" "+this.options.classes.lastMonth),this.options.constraints&&(this.options.constraints.startDate&&t.isBefore(n(this.options.constraints.startDate))&&(p+=" "+this.options.classes.inactive),this.options.constraints.endDate&&t.isAfter(n(this.options.constraints.endDate))&&(p+=" "+this.options.classes.inactive)),!t.isValid()&&t.hasOwnProperty("_d")&&void 0!=t._d&&(t=n(t._d)),p+=" calendar-day-"+t.format("YYYY-MM-DD"),p+=" calendar-dow-"+t.weekday(),this.calendarDay({day:t.date(),classes:this.options.targets.day+p,events:s,date:t})},e.prototype.render=function(){this.calendarContainer.children().remove();var t=this.createDaysObject(this.month),e=(this.month,{daysOfTheWeek:this.daysOfTheWeek,numberOfRows:Math.ceil(t.length/7),days:t,previousMonth:this.month.clone().subtract(1,"month").format("MMMM"),month:this.month.format("MMMM"),nextMonth:this.month.clone().add(1,"month").format("MMMM"),year:this.month.year(),eventsThisMonth:this.eventsThisMonth,eventsLastMonth:this.eventsLastMonth,eventsNextMonth:this.eventsNextMonth,extras:this.options.extras});if(this.calendarContainer.html(this.options.render?this.options.render.apply(this,[e]):this.compiledClndrTemplate(e)),this.options.constraints){for(var s in this.options.targets)s!=this.options.targets.day&&this.element.find("."+this.options.targets[s]).toggleClass(this.options.classes.inactive,!1);var o=null,i=null;this.options.constraints.startDate&&(o=n(this.options.constraints.startDate)),this.options.constraints.endDate&&(i=n(this.options.constraints.endDate)),o&&this.month.isSame(o,"month")&&this.element.find("."+this.options.targets.previousButton).toggleClass(this.options.classes.inactive,!0),i&&this.month.isSame(i,"month")&&this.element.find("."+this.options.targets.nextButton).toggleClass(this.options.classes.inactive,!0),o&&n(o).subtract(1,"years").isBefore(n(this.month).subtract(1,"years"))&&this.element.find("."+this.options.targets.previousYearButton).toggleClass(this.options.classes.inactive,!0),i&&n(i).add(1,"years").isAfter(n(this.month).add(1,"years"))&&this.element.find("."+this.options.targets.nextYearButton).toggleClass(this.options.classes.inactive,!0),(o&&o.isAfter(n(),"month")||i&&i.isBefore(n(),"month"))&&this.element.find("."+this.options.targets.today).toggleClass(this.options.classes.inactive,!0)}this.options.doneRendering&&this.options.doneRendering.apply(this,[])},e.prototype.bindEvents=function(){var n=t(this.element),e=this;n.on("click","."+this.options.targets.day,function(n){if(e.options.clickEvents.click){var s=e.buildTargetObject(n.currentTarget,!0);e.options.clickEvents.click.apply(e,[s])}e.options.adjacentDaysChangeMonth&&(t(n.currentTarget).is("."+e.options.classes.lastMonth)?e.backActionWithContext(e):t(n.currentTarget).is("."+e.options.classes.nextMonth)&&e.forwardActionWithContext(e))}),n.on("click","."+this.options.targets.empty,function(n){if(e.options.clickEvents.click){var s=e.buildTargetObject(n.currentTarget,!1);e.options.clickEvents.click.apply(e,[s])}e.options.adjacentDaysChangeMonth&&(t(n.currentTarget).is("."+e.options.classes.lastMonth)?e.backActionWithContext(e):t(n.currentTarget).is("."+e.options.classes.nextMonth)&&e.forwardActionWithContext(e))}),n.on("click","."+this.options.targets.previousButton,{context:this},this.backAction).on("click","."+this.options.targets.nextButton,{context:this},this.forwardAction).on("click","."+this.options.targets.todayButton,{context:this},this.todayAction).on("click","."+this.options.targets.nextYearButton,{context:this},this.nextYearAction).on("click","."+this.options.targets.previousYearButton,{context:this},this.previousYearAction)},e.prototype.buildTargetObject=function(e,s){var o={element:e,events:[],date:null};if(s){var i,a=e.className.indexOf("calendar-day-");0!==a?(i=e.className.substring(a+13,a+23),o.date=n(i)):o.date=null,this.options.events&&(o.events=t.makeArray(this.options.multiDayEvents?t(this.options.events).filter(function(){return(o.date.isSame(this._clndrStartDateObject,"day")||o.date.isAfter(this._clndrStartDateObject,"day"))&&(o.date.isSame(this._clndrEndDateObject,"day")||o.date.isBefore(this._clndrEndDateObject,"day"))}):t(this.options.events).filter(function(){return this._clndrDateObject.format("YYYY-MM-DD")==i})))}return o},e.prototype.forwardAction=function(t){var n=t.data.context;n.forwardActionWithContext(n)},e.prototype.backAction=function(t){var n=t.data.context;n.backActionWithContext(n)},e.prototype.backActionWithContext=function(t){if(!t.element.find("."+t.options.targets.previousButton).hasClass("inactive")){var e=!t.month.isSame(n(t.month).subtract(1,"months"),"year");t.month.subtract(1,"months"),t.render(),t.options.clickEvents.previousMonth&&t.options.clickEvents.previousMonth.apply(t,[n(t.month)]),t.options.clickEvents.onMonthChange&&t.options.clickEvents.onMonthChange.apply(t,[n(t.month)]),e&&t.options.clickEvents.onYearChange&&t.options.clickEvents.onYearChange.apply(t,[n(t.month)])}},e.prototype.forwardActionWithContext=function(t){if(!t.element.find("."+t.options.targets.nextButton).hasClass("inactive")){var e=!t.month.isSame(n(t.month).add(1,"months"),"year");t.month.add(1,"months"),t.render(),t.options.clickEvents.nextMonth&&t.options.clickEvents.nextMonth.apply(t,[n(t.month)]),t.options.clickEvents.onMonthChange&&t.options.clickEvents.onMonthChange.apply(t,[n(t.month)]),e&&t.options.clickEvents.onYearChange&&t.options.clickEvents.onYearChange.apply(t,[n(t.month)])}},e.prototype.todayAction=function(t){var e=t.data.context,s=!e.month.isSame(n(),"month"),o=!e.month.isSame(n(),"year");e.month=n().startOf("month"),e.options.clickEvents.today&&e.options.clickEvents.today.apply(e,[n(e.month)]),s&&(e.render(),e.month=n(),e.options.clickEvents.onMonthChange&&e.options.clickEvents.onMonthChange.apply(e,[n(e.month)]),o&&e.options.clickEvents.onYearChange&&e.options.clickEvents.onYearChange.apply(e,[n(e.month)]))},e.prototype.nextYearAction=function(t){var e=t.data.context;e.element.find("."+e.options.targets.nextYearButton).hasClass("inactive")||(e.month.add(1,"years"),e.render(),e.options.clickEvents.nextYear&&e.options.clickEvents.nextYear.apply(e,[n(e.month)]),e.options.clickEvents.onMonthChange&&e.options.clickEvents.onMonthChange.apply(e,[n(e.month)]),e.options.clickEvents.onYearChange&&e.options.clickEvents.onYearChange.apply(e,[n(e.month)]))},e.prototype.previousYearAction=function(t){var e=t.data.context;e.element.find("."+e.options.targets.previousYear).hasClass("inactive")||(e.month.subtract(1,"years"),e.render(),e.options.clickEvents.previousYear&&e.options.clickEvents.previousYear.apply(e,[n(e.month)]),e.options.clickEvents.onMonthChange&&e.options.clickEvents.onMonthChange.apply(e,[n(e.month)]),e.options.clickEvents.onYearChange&&e.options.clickEvents.onYearChange.apply(e,[n(e.month)]))},e.prototype.forward=function(t){return this.month.add(1,"months"),this.render(),t&&t.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[n(this.month)]),0===this.month.month()&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[n(this.month)])),this},e.prototype.back=function(t){return this.month.subtract(1,"months"),this.render(),t&&t.withCallbacks&&(this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[n(this.month)]),11===this.month.month()&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[n(this.month)])),this},e.prototype.next=function(t){return this.forward(t),this},e.prototype.previous=function(t){return this.back(t),this},e.prototype.setMonth=function(t,e){return this.month.month(t),this.render(),e&&e.withCallbacks&&this.options.clickEvents.onMonthChange&&this.options.clickEvents.onMonthChange.apply(this,[n(this.month)]),this},e.prototype.nextYear=function(t){return this.month.add(1,"year"),this.render(),t&&t.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[n(this.month)]),this},e.prototype.previousYear=function(t){return this.month.subtract(1,"year"),this.render(),t&&t.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[n(this.month)]),this},e.prototype.setYear=function(t,e){return this.month.year(t),this.render(),e&&e.withCallbacks&&this.options.clickEvents.onYearChange&&this.options.clickEvents.onYearChange.apply(this,[n(this.month)]),this},e.prototype.setEvents=function(t){return this.options.events=this.options.multiDayEvents?this.addMultiDayMomentObjectsToEvents(t):this.addMomentObjectToEvents(t),this.render(),this},e.prototype.addEvents=function(n){return this.options.events=this.options.multiDayEvents?t.merge(this.options.events,this.addMultiDayMomentObjectsToEvents(n)):t.merge(this.options.events,this.addMomentObjectToEvents(n)),this.render(),this},e.prototype.removeEvents=function(t){for(var n=this.options.events.length-1;n>=0;n--)1==t(this.options.events[n])&&this.options.events.splice(n,1);return this.render(),this},e.prototype.addMomentObjectToEvents=function(t){var e=this,s=0,o=t.length;for(s;o>s;s++)t[s]._clndrDateObject=n(t[s][e.options.dateParameter]);return t},e.prototype.addMultiDayMomentObjectsToEvents=function(t){var e=this,s=0,o=t.length;for(s;o>s;s++)t[s][e.options.multiDayEvents.endDate]||t[s][e.options.multiDayEvents.startDate]?(t[s]._clndrEndDateObject=n(t[s][e.options.multiDayEvents.endDate]||t[s][e.options.multiDayEvents.startDate]),t[s]._clndrStartDateObject=n(t[s][e.options.multiDayEvents.startDate]||t[s][e.options.multiDayEvents.endDate])):(t[s]._clndrEndDateObject=n(t[s][e.options.multiDayEvents.singleDay]),t[s]._clndrStartDateObject=n(t[s][e.options.multiDayEvents.singleDay]));return t},e.prototype.calendarDay=function(n){var e={day:"",classes:this.options.targets.empty,events:[],date:null};return t.extend({},e,n)},t.fn.clndr=function(t){if(1===this.length){if(!this.data("plugin_clndr")){var n=new e(this,t);return this.data("plugin_clndr",n),n}}else if(this.length>1)throw new Error("CLNDR does not support multiple elements yet. Make sure your clndr selector returns only one element.")}});